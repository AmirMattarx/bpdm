name: Build and Push Docker Image

on:
  push:
    paths:
      - 'pom.xml'
      - 'gpdm-common/**'
      - 'gpdm-wrapper/**'
    branches:
      - main
      - develop

jobs:
  call-sonar-scan:
    uses: ./.github/workflows/sonar-scan.yaml
    secrets: inherit

  call-release:
    needs: [call-sonar-scan]
    uses:  ./.github/workflows/release.yaml
    with:
      imageName: bpdm-wrapper
      dockerfilePath: ./gpdm-wrapper/Dockerfile